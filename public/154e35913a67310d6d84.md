---
title: JetpackGlanceã‚’ä½¿ç”¨ã—ã¦Githubã®Contributionã‚’Widgetã¨ã—ã¦è¡¨ç¤ºã—ã¦ã¿ã‚‹
tags:
  - Material
  - DroidKaigi
  - JetpackCompose
  - JetpackGlance
private: false
updated_at: '2023-12-14T02:10:30+09:00'
id: 154e35913a67310d6d84
organization_url_name: null
slide: false
ignorePublish: false
---
# ã¯ã˜ã‚ã«

å²©æ‰‹çœŒç«‹å¤§å­¦ã®ä½è—¤ä½‘å“‰ã§ã™ã€‚æœ€è¿‘ã€å²©æ‰‹çœŒã§ã¯é›ªãŒé™ã‚Šã€å†¬ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹å­£ç¯€ã¨ãªã£ã¦ãã¾ã—ãŸã€‚

ã—ã‹ã—ã€å¯’ãã¦ã‚‚Kotlinã¸ã®ç†±ã¯çµ¶ãˆãªã„ãŸã‚ã€Jetpack Glanceã‚’ç”¨ã„ãŸWidgetã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™(!?)

## Jetpack Glanceã¨ã¯ï¼Ÿ

Jetpack Glanceã¯Jetpack Composeã®runtimeä¸Šã«æ§‹ç¯‰ã•ã‚ŒãŸãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€ã‚¢ãƒ—ãƒªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã§ãã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚

2021å¹´æœ«ã‚ãŸã‚Šã‹ã‚‰alphaç‰ˆãŒå‡ºã¦ã„ãŸã®ã§ã™ãŒã€ã¤ã„3ãƒ¶æœˆå‰(2023å¹´9æœˆ)ã«1.0.0ãŒStableã«ãªã‚Šã¾ã—ãŸï¼

ã¡ãªã¿ã«DroidKaigi 2023ã§ã‚‚Jetpack Glanceã¯ç´¹ä»‹ã•ã‚Œã¦ãŠã‚Šã¾ã™ï¼

https://speakerdeck.com/mochico/jetpack-glancedehazimeru-material-3nocolor

## ä»•çµ„ã¿
Glanceã‹ã‚‰æä¾›ã•ã‚ŒãŸComposableã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Jetpack Compose ãƒ©ãƒ³ã‚¿ãƒ ã‚’ä½¿ç”¨ã—ã¦[RemoteView](https://developer.android.com/reference/android/widget/RemoteViews)ã«å¤‰æ›ã—ã€ãã‚Œã‚’ã‚¢ãƒ—ãƒªã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«è¡¨ç¤ºã—ã¾ã™ã€‚

ã“ã®ã“ã¨ã‹ã‚‰Composeã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã€RemoteViewã®åˆ¶ç´„ã®å½±éŸ¿ã‚’å¤§ããå—ã‘ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã“ã®[è¨˜äº‹](https://android-developers-jp.googleblog.com/2022/01/announcing-jetpack-glance-alpha-for-app.html)ãŒä»•çµ„ã¿ã«ã¤ã„ã¦è©³ã—ããŠè©±ã—ã—ã¦ã„ã¾ã™ã€‚

https://android-developers-jp.googleblog.com/2022/01/announcing-jetpack-glance-alpha-for-app.html


## ä½œã‚ŠãŸã„Widget

ä»Šå›ã¯Githubã®Contributionã‚’è¡¨ç¤ºã™ã‚‹Widgetã‚’å®Ÿè£…ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚
iPhoneã§ã®Widgetã¯ä¸‹è¨˜å†™çœŸã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã§ã€
ã“ã‚Œã«ä¼¼ãŸWidgetã‚’Androidã§ã‚‚å®Ÿè£…ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

~~ãªãœã€iPhoneã®ã‚¹ã‚¯ã‚·ãƒ§ã‹ã¨ã„ã†ã¨ã€ç§ãŒiPhoneã‚’ãƒ¡ã‚¤ãƒ³ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚~~

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2989029/4ec2f3f1-3637-d3f0-fe1f-f2bacb1bcdaa.jpeg" width="500">

## å®Ÿè£…
### ä¾å­˜é–¢ä¿‚ã®è¿½åŠ ã¨Composeã‚’æœ‰åŠ¹åŒ–
ã›ã£ã‹ããªã®ã§`androidx.glance:glance-material3:1.0.0`ã‚‚è¿½åŠ ã—ã¾ã™ã€‚

```kotlin
buildFeatures {
        compose = true
        //...
}
dependencies {
    implementation "androidx.glance:glance-appwidget:1.0.0"
    implementation "androidx.glance:glance-material3:1.0.0"
    //...
}
```


## Widgetã‚’è¡¨ç¤ºã™ã‚‹
ã“ã“ã§ã¯ã€ç°¡å˜ã«Widgetã‚’è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã™ã€‚
### GlanceAppWidgetã‚¯ãƒ©ã‚¹ã§Widgetã®ç”»é¢ã‚’ä½œæˆã™ã‚‹ã€‚
`GlanceAppWidget`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
ãã—ã¦ã€`provideGlance()`ã—ã¦ã€`provideContent()`ã®å¼•æ•°ã«Composableã‚’æ¸¡ã—ã¾ã™ã€‚
ã“ã“ã§å®Ÿè£…ã—ãŸUIãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ãªä»•çµ„ã¿ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚

```kotlin
import android.content.Context
import androidx.compose.runtime.Composable
import androidx.compose.ui.unit.dp
import androidx.glance.GlanceId
import androidx.glance.GlanceModifier
import androidx.glance.GlanceTheme
import androidx.glance.appwidget.GlanceAppWidget
import androidx.glance.appwidget.appWidgetBackground
import androidx.glance.appwidget.provideContent
import androidx.glance.background
import androidx.glance.layout.Alignment
import androidx.glance.layout.Column
import androidx.glance.layout.fillMaxSize
import androidx.glance.layout.padding
import androidx.glance.text.Text

class GlanceSampleWidget : GlanceAppWidget() {
    override suspend fun provideGlance(context: Context, id: GlanceId) {
        provideContent { GlanceSampleContent() }
    }

    @Composable
    private fun GlanceSampleContent() {
        GlanceTheme {
            Column(
                modifier = GlanceModifier
                    .fillMaxSize()
                    .padding(16.dp)
                    .appWidgetBackground()
                    .background(GlanceTheme.colors.primaryContainer),
                horizontalAlignment = Alignment.CenterHorizontally,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text("Hello Glance!")
            }
        }
    }
}
```

æ™®æ®µã®æ›¸ãæ–¹ã¨ã¯ã ã„ã¶é•ã†ã¨æ€ã„ã¾ã™ã€‚
æ™®é€šã®`Modifier`ã¨ã¯é•ã„ã€Glanceã§ã¯`GlanceModifier`ã‚’ä½¿ç”¨ã—ãŸã‚Šã€`Text`ã‚„`Column`ã®å‚ç…§å…ˆã¯`androidx.glance.*`ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«Jetpack Glanceã§ã¯Composeã¨ã¯ç•°ãªã‚‹
Composableã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã—ã¦ãŠã‚Šã¾ã™ã€‚

### GlanceAppWidgetReceiverã‚¯ãƒ©ã‚¹
æ¬¡ã«`GlanceAppWidgetReceiver`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆãƒ»æ›´æ–°ã™ã‚‹å½¹ç›®ã‚’æœãŸã™ã‚¯ãƒ©ã‚¹ã§ã™ã€‚

```kotlin
class GlanceSampleWidgetReceiver(override val glanceAppWidget: GlanceAppWidget = GlanceSampleWidget()) :
    GlanceAppWidgetReceiver()
```

### metadataã®è¨˜å…¥
ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãã¾ã™ã€‚
glanceã§ã¯ã€`@layout/glance_default_loading_layout`ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚

```xml:xml:.xml
<appwidget-provider xmlns:android="http://schemas.android.com/apk/res/android"
    android:initialLayout="@layout/glance_default_loading_layout"
    android:updatePeriodMillis="86400000" />
```

### AndroidManifest.xmlã«AppWidgetã‚’è¨­å®š
å…ˆã»ã©å®Ÿè£…ã—ãŸAppWidgetã‚¯ãƒ©ã‚¹ã‚’AppWidgetã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†è¨˜è¿°ã—ã¦ãŠãã¾ã™ã€‚
```xml:AndroidManifest.xml
<receiver
            android:name=".widget.GlanceSampleWidgetReceiver"
            android:exported="true">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/glance_sample_widget_info" />
</receiver>
```

ã“ã®æ‰‹ç¶šãã‚’ã™ã‚€ã“ã¨ã§Androidã®æ–¹ã‹ã‚‰Widgetã¨ã—ã¦èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ï¼

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2989029/aadb87a0-34f8-0f40-0728-7f4498f796f9.png" width="300">





## Github Contributionã‚’è¡¨ç¤ºã•ã›ã‚‹
ã“ã“ã‹ã‚‰è¨˜äº‹ã®æœ¬é¡Œã«å…¥ã‚Šã¾ã™ğŸ‘€
### Github Contributionã®å–å¾—
å¤§ã¾ã‹ãªå®Ÿè£…ã¯çœç•¥ã„ãŸã—ã¾ã™ãŒã€ä¸‹è¨˜UseCaseã‹ã‚‰Githubã®Contributionã‚’å–å¾—ã—ã¦ã„ã‚‹ã“ã¨ã‚’å¿µé ­ã«ç½®ã„ã¦ãŠãã¾ã™ğŸ‘€
```kotlin

// Contributionã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹
data class Contribution(
    val date: LocalDate,
    val count: Int,
)

// éå»2ãƒ¶æœˆåˆ†ã®Contributionã‚’å–å¾—ã™ã‚‹UseCaseã‚¯ãƒ©ã‚¹
class GetContributionsForThePastTwoMonthsUseCase(
    private val githubRepository: GithubRepository
) {

    companion object {
        private const val DAYS_IN_PAST_TWO_MONTHS = 62
    }

    operator fun invoke(username: String): Flow<List<Contribution>> = flow {
        // ä»Šæ—¥ã®æ™‚é–“ã‚’å–å¾—ã™ã‚‹
        val today = Clock.System.now()

        // 2ãƒ¶æœˆå‰ã®æ™‚é–“ã‚’å–å¾—ã™ã‚‹
        val from = today.minus(DAYS_IN_PAST_TWO_MONTHS.days)

        // Contributionã‚’emitã—ã€ä¸Šä½ã«æµã—ã¾ã™ã€‚
        githubRepository.getContributions(
            username = username,
            from = from.toString(),
            to = today.toString()
        )
            .catch { throw it }
            .collect(::emit)
    }
}

```

### Contributionã‚’å†™çœŸã®ã‚ˆã†ã«è¡¨ç¤ºã™ã‚‹æ™‚ã®å•é¡Œç‚¹
#### LazyHorizontalGridã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
Jetpack Glanceã§ã¯LazyHorizontalGridã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ãŸã‚ã€Contributionsã‚’ç†æƒ³ã®Widgetã®ã‚ˆã†ã«ãŠæ‰‹è»½ã«è¡¨ç¤ºã§ãã¾ã›ã‚“ã€‚
#### LazyRowã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
Jetpack Glanceã§ã¯LazyRowã¯ï¼ˆä»¥ä¸‹ç•¥ï¼‰ã€‚

### ã“ã®å•é¡Œç‚¹ã‚’ãµã¾ãˆã¦
`List<Contribution>`ã‚’è¦ç´ æ•°7ã®äºŒæ¬¡å…ƒé…åˆ—ã«åˆ†ã‘ã¦ã€forEachã§è¡¨ç¤ºã™ã‚‹ã¨ã„ã†å½¢ã§å®Ÿè£…ã„ãŸã—ã¾ã—ãŸã€‚
```kotlin:widget/GithubContributionWidget.kt
@Composable
    private fun GithubContributionsWidgetContent(
        contributions: List<Contribution>
    ) {
        // 1ã¤ã®è¦ç´ ãŒ1é€±é–“åˆ†ã®Contributionã‚’è¡¨ã™
        // weeks = [[Contribution, Contribution, ...], [Contribution, Contribution, ...], ...]
        val weeks = remember(contributions) { contributions.chunked(7) }
        GlanceTheme {
            Box(
                modifier = GlanceModifier
                    .fillMaxSize()
                    .appWidgetBackground()
                    .background(GlanceTheme.colors.background),
                contentAlignment = Alignment.Center
            ) {
                Row {
                    weeks.forEach { weekContributions ->
                        Column(GlanceModifier.padding(1.dp)) {
                            weekContributions.forEach { contribution ->
                                Spacer(
                                    modifier = GlanceModifier
                                        .size(12.dp)
                                        .padding(1.dp)
                                        .cornerRadius(4.dp)
                                        .background(getGithubContributionColor(contribution.count))
                                )
                            }
                        }
                    }
                }
            }
        }
    }
```

ä»¥ä¸‹ã®ã‚ˆã†ã«Widgetã‚’å®Ÿè£…ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼
è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ã‚’æ„è­˜ã—ã¦ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åº¦å¤–è¦–ã—ã¦å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã‚ã¾ã‚Šè‰¯ã„å®Ÿè£…ã¨ã¯è¨€ãˆã¾ã›ã‚“ğŸ˜…
ã—ã‹ã—ã€iPhoneã¨ã¯Contributionã®æ•°ãŒå°‘ãªã„ã‚ˆã†ã«æ„Ÿã˜ã¾ã™ãƒ»ãƒ»ãƒ»ã€‚

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2989029/81fe7cf6-979d-9a77-88bc-3e782fa18b37.jpeg" width="500">

## glanceã®Composableã¯å­è¦ç´ ã‚’11å€‹ä»¥ä¸Šè¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ããªã„
ç¾åœ¨ã€GlanceãŒæä¾›ã—ã¦ã„ã‚‹Composableã¯å­è¦ç´ ã‚’10å€‹ä»¥ä¸ŠæŒã¦ãªã„ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚
ãã®ãŸã‚ã€3ãƒ¶æœˆ(93æ—¥)åˆ†ã®Contributionã‚’ã‚²ãƒƒãƒˆã—ã¦è¡¨ç¤ºã•ã›ã‚ˆã†ã¨ã—ã¦ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
70æ—¥åˆ†ã®Contributionã¯è¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ãã‚Œä»¥é™ã®Contributionã¯åˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚


<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2989029/fd52cfd8-d6b4-7d7e-fc6a-ae93ec450726.jpeg" width="500">

:::note warn
Glanceã‹ã‚‰æä¾›ã•ã‚ŒãŸRowã‚„Columnãªã©ã®Composableã¯æœ€å¤§10å€‹ã®å­è¦ç´ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ãŒã€ãã‚Œä»¥ä¸Šã®è¦ç´ ã¯åˆ‡ã‚Šæ¨ã¦ã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
:::

# ã¾ã¨ã‚
æœ¬è¨˜äº‹ã§ã¯ã€Jetpack Glanceã‚’ä½¿ç”¨ã—ã¦Widgetã®è¡¨ç¤ºã®ä»•æ–¹ã‹ã‚‰Githubã®Contributionã‚’è¡¨ç¤ºã•ã›ã‚‹ã¨ã“ã‚ã¾ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚
Jetpack GlanceãŒStableã«ãªã£ã¦ã€Widgetã«ã¤ã„ã¦ã‚‚å®£è¨€çš„ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€ã¾ã™ã¾ã™é–‹ç™ºè€…ä½“é¨“ãŒä¸ŠãŒã‚‹ã“ã¨ãŒæœŸå¾…ã§ããã†ã§ã™ï¼
ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã§ã¯å³ã—ã„è¦ä»¶ã‚„åˆ¶ç´„ãŒã‚ã£ãŸãŸã‚ã«å®Ÿè£…ãŒè¤‡é›‘ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ç°¡å˜ãªWidgetã«é–¢ã—ã¦ã¯ç°¡å˜ã«ä½œã‚Œã‚‹ã®ã§ã€èª°ã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ğŸ™‡â€â™‚ï¸

ä¸‹è¨˜ã«å®Ÿè£…ã—ãŸgithubã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã£ã¦ãŠãã¾ã™ï¼å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ğŸ™‡â€â™‚ï¸

https://github.com/dao0203/github-profile-sample


## å‚è€ƒè¨˜äº‹

https://speakerdeck.com/mochico/jetpack-glancedehazimeru-material-3nocolor

https://developer.android.com/reference/android/widget/RemoteViews

https://android-developers-jp.googleblog.com/2022/01/announcing-jetpack-glance-alpha-for-app.html
